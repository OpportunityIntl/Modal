/* OI-Modals v0.9.4 
 * Copyright (c) 2015 Opportunity International 
 */
!function(a){a.fn.modal=function(c){return this.each(function(){new b(a(this),c)})},a.fn.modal.defaults={content:null,zIndex:3,closeable:!0,beforeOpen:function(){},afterOpen:function(){},beforeClose:function(){},afterClose:function(){},fixedElements:[]},a.modal=function(a){return new b(null,a).open()};var b=function(b,c){function d(){var a;return a=e()?f()?"video":"url":g()?"content":"dynamic"}function e(){return/^https?:\/\//.test(s.options.source)}function f(){return/^https?:\/\/(www\.youtube|player\.vimeo)/.test(s.options.source)}function g(){return a(s.options.source).length>0?!0:!1}function h(){s.element&&(s.element.find(".modal-container").outerHeight()+40>=a(window).height()?s.element.addClass("overflow"):s.element.removeClass("overflow"))}function i(){var b=window.innerWidth;if(!b){var c=document.documentElement.getBoundingClientRect();b=c.right-Math.abs(c.left)}var d=b-a("body").width();v?a("#content").css("padding-right",d):a("body").css("padding-right",d),a.each(w,function(a,b){b.element.css(b.property,parseInt(b.element.css(b.property))+d)})}function j(){v?a("#content").css("padding-right",""):a("body").css("padding-right",""),a.each(w,function(a,b){b.element.css(b.property,"")})}function k(){i(),v?(u=a(window).scrollTop(),a("body").addClass("ios-no-scroll"),a("#content").css("top",-u)):a("body").addClass("no-scroll")}function l(){setTimeout(function(){j(),v?(a("body").removeClass("ios-no-scroll"),a(window).scrollTop(u),a("#content").css("top",0)):a("body").removeClass("no-scroll")},500)}function m(){if(s.element){var a=s.element.find(".modal-container");s.element.hasClass("overflow")?a.css("margin-top",""):a.css("margin-top",-a.height()/2)}}function n(){s.element.css("z-index",s.options.zIndex)}function o(){v&&0===a("#content").length&&a("body").wrapInner('<div id="content">')}function p(){var b;switch(s.type){case"video":b=a("<div>",{"class":"flex-video"}),b.append(a("<iframe>",{src:s.trigger.data("modal"),frameborder:0})),s.options.content=b,s.element=q();break;case"url":b=a("<div>",{"class":"iframe"}),b.append(a("<iframe>",{src:s.trigger.data("modal"),frameborder:0})),s.options.content=b,s.element=q();break;case"content":s.element=a(s.options.source);break;case"dynamic":s.element=q()}s.element.data("modal",s)}function q(){var b=a("<div>",{"class":"modal"});return b.append(a("<div>",{"class":"modal-container"})),b.find(".modal-container").append(a("<button>",{type:"button","class":"reset icon-cross close"})),b.find(".modal-container").append(a("<div>",{"class":"modal-content"})),s.options.classes&&b.find(".modal-container").addClass(s.options.classes),b.find(".modal-content").append(s.options.content),a("body").append(b),b.data("destroyOnClose",!0),b}function r(){o(),s.trigger.click(function(){return s.open(),!1}),a(window).resize(function(){h(),Modernizr.csstransforms||m()})}var s=this;this.trigger=a(b),this.element=null;var t={classes:s.trigger.data("modal-classes")||null,source:s.trigger.data("modal")||null,type:s.trigger.data("modal-type")||null};this.options=a.extend({},t,a.fn.modal.defaults,c),this.content="function"==typeof this.options.content?this.options.content.call(this.trigger):this.options.content,this.type=this.options.type||d();var u=0,v=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,w=a.merge([{element:a(".modal button.close.fixed"),property:"right"}],this.options.fixedElements);this.open=function(){return p(),s.element.find(".modal-container").css({"transition-duration":".5s, .3s","-webkit-transition-duration":".5s, .3s"}),s.options.beforeOpen.call(s.element,s)===!1?!1:(Modernizr.rgba||s.element.prepend(a("<div>",{"class":"ie8-overlay"})),k(),n(),s.element.addClass("animate"),setTimeout(function(){h(),s.element.addClass("show"),Modernizr.csstransforms||m()},100),setTimeout(function(){s.element.find(".modal-container").css({"transition-duration":"","-webkit-transition-duration":""})},150),s.element.find(".close").bind("click.modal",function(){s.close()}),s.options.closeable?(s.element.bind("click.modal",function(){s.close()}),s.element.find(".modal-container").bind("click.modal",function(a){a.stopPropagation()}),a(document).bind("keyup.modal",function(a){"27"==a.keyCode&&s.close()})):s.element.find("button.close").hide(),setTimeout(function(){s.options.afterOpen.call(s.element,s)},600),s)},this.close=function(){return s.options.beforeClose.call(s.element,s)===!1?!1:(s.element.find(".modal-container").css({"transition-duration":".5s, .3s","-webkit-transition-duration":".5s, .3s"}),l(),s.element.find(".close").unbind("click.modal"),a("#modals").unbind("click.modal"),s.element.unbind("click.modal"),a(document).unbind("keyup.modal"),s.element.removeClass("show"),setTimeout(function(){s.element.removeClass("animate"),h(),Modernizr.rgba||s.element.find(".ie8-overlay").remove(),s.element.find(".modal-container").css({"transition-duration":"","-webkit-transition-duration":""}),s.options.afterClose.call(s.element,s),s.element.data("destroyOnClose")&&s.element.remove()},500),s)},r()};window.Modal=b}(jQuery);