/* OI-Modals v0.9.6 
 * Copyright (c) 2015 Opportunity International 
 */
!function(a){a.fn.modal=function(b){return this.each(function(){new d(a(this),b)})},a.fn.modal.defaults={content:null,zIndex:3,closeable:!0,scrollFixClass:"ios-scroll-container",beforeOpen:function(){},afterOpen:function(){},beforeClose:function(){},afterClose:function(){},fixedElements:[]},a.modal=function(a){return new d(null,a).open()};var b=[],c=0,d=function(d,e){function f(){var a;return a=g()?h()?"video":"url":i()?"content":"dynamic"}function g(){return/^https?:\/\//.test(u.options.source)}function h(){return/^https?:\/\/(www\.youtube|player\.vimeo)/.test(u.options.source)}function i(){return a(u.options.source).length>0?!0:!1}function j(){u.element&&(u.element.find(".modal-container").outerHeight()+40>=a(window).height()?u.element.addClass("overflow"):u.element.removeClass("overflow"))}function k(){var b=window.innerWidth;if(!b){var c=document.documentElement.getBoundingClientRect();b=c.right-Math.abs(c.left)}var d=b-a("body").width();w?a("."+u.options.scrollFixClass).css("padding-right",d):a("body").css("padding-right",d),a.each(x,function(a,b){"function"==typeof b.property?b.property.call(b.element,d):(b.originalValue=parseInt(b.element.css(b.property)),b.element.css(b.property,b.originalValue+d))})}function l(){w?a("."+u.options.scrollFixClass).css("padding-right",""):a("body").css("padding-right",""),a.each(x,function(a,b){"function"==typeof b.property?b.property.call(b.element,0):b.element.css(b.property,b.originalValue||"")})}function m(){k(),w?(c=a(window).scrollTop(),a("body").addClass("ios-no-scroll"),a("."+u.options.scrollFixClass).css("top",-c)):a("body").addClass("no-scroll")}function n(){l(),w?(a("body").removeClass("ios-no-scroll"),a(window).scrollTop(c),a("."+u.options.scrollFixClass).css("top",0)):a("body").removeClass("no-scroll")}function o(){if(u.element){var a=u.element.find(".modal-container");u.element.hasClass("overflow")?a.css("margin-top",""):a.css("margin-top",-a.height()/2)}}function p(){u.element.css("z-index",u.options.zIndex)}function q(){w&&0===a("."+u.options.scrollFixClass).length&&a("body").wrapInner('<div class="'+u.options.scrollFixClass+'">')}function r(){switch(u.type){case"video":case"url":u.content=a("<div>",{"class":"video"===u.type?"flex-video":"iframe"}).append(a("<iframe>",{src:u.trigger.data("modal"),frameborder:0})),u.element=s();break;case"content":u.element=a(u.options.source);break;case"dynamic":u.element=s()}u.element.data("modal",u)}function s(){var b=a("<div>",{"class":"modal"}),c=a("<div>",{"class":"modal-container"}),d=a("<div>",{"class":"modal-content"}),e=a("<button>",{type:"button","class":"reset icon-cross close"});return b.append(c.append([e,d.append(u.content)])),u.options.classes&&c.addClass(u.options.classes),a("body").append(b),b.data("destroyOnClose",!0),b}function t(){q(),u.trigger.click(function(){return u.open(),!1}),a(window).resize(function(){j(),Modernizr.csstransforms||o()})}var u=this;this.trigger=a(d),this.element=null;var v={classes:u.trigger.data("modal-classes")||null,source:u.trigger.data("modal")||null,type:u.trigger.data("modal-type")||null};this.options=a.extend({},v,a.fn.modal.defaults,e),this.content="function"==typeof this.options.content?this.options.content.call(this.trigger):this.options.content,this.type=this.options.type||f(),this.openModals=b;var w=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!/CriOS/.test(navigator.userAgent)&&!window.MSStream,x=a.merge([{element:a(".modal button.close.fixed"),property:"right"}],this.options.fixedElements);this.open=function(){return r(),u.element.find(".modal-container").css({"transition-duration":".5s, .3s","-webkit-transition-duration":".5s, .3s"}),u.options.beforeOpen.call(u.element,u)===!1?!1:(0===b.length&&m(),b.length>0&&b[b.length-1].close(),b.push(u),Modernizr.rgba||u.element.prepend(a("<div>",{"class":"ie8-overlay"})),p(),u.element.addClass("animate"),setTimeout(function(){j(),u.element.addClass("show"),Modernizr.csstransforms||o()},100),setTimeout(function(){u.element.find(".modal-container").css({"transition-duration":"","-webkit-transition-duration":""})},150),u.element.on("click.modal",".close",function(a){u.close(),a.stopPropagation()}),u.options.closeable?(u.element.on("click.modal",function(){u.close()}),u.element.on("click.modal",".modal-container",function(a){a.stopPropagation()}),a(document).bind("keyup.modal",function(a){"27"==a.keyCode&&u.close()})):u.element.find("button.close").hide(),setTimeout(function(){u.options.afterOpen.call(u.element,u)},600),u)},this.close=function(){return u.options.beforeClose.call(u.element,u)===!1?!1:(b.pop(),u.element.find(".modal-container").css({"transition-duration":".5s, .3s","-webkit-transition-duration":".5s, .3s"}),u.element.off("click.modal"),a(document).unbind("keyup.modal"),u.element.removeClass("show"),setTimeout(function(){0===b.length&&n(),u.element.removeClass("animate"),j(),Modernizr.rgba||u.element.find(".ie8-overlay").remove(),u.element.find(".modal-container").css({"transition-duration":"","-webkit-transition-duration":""}),u.options.afterClose.call(u.element,u),u.element.data("destroyOnClose")&&u.element.remove()},500),u)},this.update=function(a,b){return u.content="function"==typeof a?a.call(u,u.element):a,u.element.find(".modal-content").html(u.content),"function"==typeof b&&b.call(u,u.element),j(),u},t()},e=function(b,c){function e(b){var c="function"==typeof i.options.aboveContent?i.options.aboveContent.call(b,j.index(b),j):i.options.aboveContent,d="function"==typeof i.options.belowContent?i.options.belowContent.call(b,j.index(b),j):i.options.belowContent,e=a("<div>",{"class":"lightbox-image"}),f=a("<img>",{src:b.attr("href"),"class":"block"});m=a("<button>",{type:"button","class":"reset lightbox-next"}).append(a('<i class="icon-arrow-right-small"></i>')),l=a("<button>",{type:"button","class":"reset lightbox-prev"}).append(a('<i class="icon-arrow-left-small"></i>')),j.index(b)>0&&e.append(l),e.append(f),j.index(b)<j.length-1&&e.append(m),l.on("click.lightbox",function(){console.log("prev button clicked"),i.prev()}),m.on("click.lightbox",function(){console.log("next button clicked"),i.next()});var g=a("<div>",{"class":"lightbox-container"}).append(a(c),e,a(d));return g}function f(b,c){console.log("Preloading image");var d=new Image;d.src=b,a(d).on("load",function(){console.log("Image loaded"),"function"==typeof c&&c.call()})}function g(){var c=a(this).attr("rel");return k=a(this),j=a(b+(c?'[rel="'+c+'"]':"")),f(k.attr("href"),function(){i.modal=new d(null,{content:e(k,j),classes:"lightbox",afterClose:h}).open(),a(document).bind("keyup.lightbox",function(a){39===a.keyCode?i.next():37===a.keyCode&&i.prev()})}),!1}function h(){j=null,k=null,l.off("click.lightbox"),m.off("click.lightbox"),l=null,m=null,a(document).unbind("keyup.lightbox")}var i=this,j=null,k=null,l=null,m=null;this.trigger=a(b),this.modal=null,this.options=a.extend({aboveContent:"",belowContent:""},c),this.next=function(){var a=j.index(k);a<j.length-1&&(k=j.eq(a+1),f(k.attr("href"),function(){i.modal.update(e(k))}))},this.prev=function(){var a=j.index(k);a>0&&(k=j.eq(a-1),f(k.attr("href"),function(){i.modal.update(e(k))}))},this.trigger.click(g)};window.Lightbox=e,window.Modal=d}(jQuery);