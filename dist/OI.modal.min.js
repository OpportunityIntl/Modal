/* OI-Modals v0.9.5 
 * Copyright (c) 2015 Opportunity International 
 */
!function(a){a.fn.modal=function(b){return this.each(function(){new c(a(this),b)})},a.fn.modal.defaults={content:null,zIndex:3,closeable:!0,beforeOpen:function(){},afterOpen:function(){},beforeClose:function(){},afterClose:function(){},fixedElements:[]},a.modal=function(a){return new c(null,a).open()};var b=[],c=function(c,d){function e(){var a;return a=f()?g()?"video":"url":h()?"content":"dynamic"}function f(){return/^https?:\/\//.test(t.options.source)}function g(){return/^https?:\/\/(www\.youtube|player\.vimeo)/.test(t.options.source)}function h(){return a(t.options.source).length>0?!0:!1}function i(){t.element&&(t.element.find(".modal-container").outerHeight()+40>=a(window).height()?t.element.addClass("overflow"):t.element.removeClass("overflow"))}function j(){var b=window.innerWidth;if(!b){var c=document.documentElement.getBoundingClientRect();b=c.right-Math.abs(c.left)}var d=b-a("body").width();w?a("#content").css("padding-right",d):a("body").css("padding-right",d),a.each(x,function(a,b){"function"==typeof b.property?b.property.call(b.element,d):(b.originalValue=parseInt(b.element.css(b.property)),b.element.css(b.property,b.originalValue+d))})}function k(){w?a("#content").css("padding-right",""):a("body").css("padding-right",""),a.each(x,function(a,b){"function"==typeof b.property?b.property.call(b.element,0):b.element.css(b.property,b.originalValue||"")})}function l(){j(),w?(v=a(window).scrollTop(),a("body").addClass("ios-no-scroll"),a("#content").css("top",-v)):a("body").addClass("no-scroll")}function m(){k(),w?(a("body").removeClass("ios-no-scroll"),a(window).scrollTop(v),a("#content").css("top",0)):a("body").removeClass("no-scroll")}function n(){if(t.element){var a=t.element.find(".modal-container");t.element.hasClass("overflow")?a.css("margin-top",""):a.css("margin-top",-a.height()/2)}}function o(){t.element.css("z-index",t.options.zIndex)}function p(){w&&0===a("#content").length&&a("body").wrapInner('<div id="content">')}function q(){var b;switch(t.type){case"video":b=a("<div>",{"class":"flex-video"}),b.append(a("<iframe>",{src:t.trigger.data("modal"),frameborder:0})),t.options.content=b,t.element=r();break;case"url":b=a("<div>",{"class":"iframe"}),b.append(a("<iframe>",{src:t.trigger.data("modal"),frameborder:0})),t.options.content=b,t.element=r();break;case"content":t.element=a(t.options.source);break;case"dynamic":t.element=r()}t.element.data("modal",t)}function r(){var b=a("<div>",{"class":"modal"});return b.append(a("<div>",{"class":"modal-container"})),b.find(".modal-container").append(a("<button>",{type:"button","class":"reset icon-cross close"})),b.find(".modal-container").append(a("<div>",{"class":"modal-content"})),t.options.classes&&b.find(".modal-container").addClass(t.options.classes),b.find(".modal-content").append(t.options.content),a("body").append(b),b.data("destroyOnClose",!0),b}function s(){p(),t.trigger.click(function(){return t.open(),!1}),a(window).resize(function(){i(),Modernizr.csstransforms||n()})}var t=this;this.trigger=a(c),this.element=null;var u={classes:t.trigger.data("modal-classes")||null,source:t.trigger.data("modal")||null,type:t.trigger.data("modal-type")||null};this.options=a.extend({},u,a.fn.modal.defaults,d),this.content="function"==typeof this.options.content?this.options.content.call(this.trigger):this.options.content,this.type=this.options.type||e();var v=0,w=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,x=a.merge([{element:a(".modal button.close.fixed"),property:"right"}],this.options.fixedElements);this.open=function(){return q(),t.element.find(".modal-container").css({"transition-duration":".5s, .3s","-webkit-transition-duration":".5s, .3s"}),t.options.beforeOpen.call(t.element,t)===!1?!1:(0===b.length&&l(),b.length>0&&b[b.length-1].close(),b.push(t),Modernizr.rgba||t.element.prepend(a("<div>",{"class":"ie8-overlay"})),o(),t.element.addClass("animate"),setTimeout(function(){i(),t.element.addClass("show"),Modernizr.csstransforms||n()},100),setTimeout(function(){t.element.find(".modal-container").css({"transition-duration":"","-webkit-transition-duration":""})},150),t.element.on("click.modal",".close",function(){t.close()}),t.options.closeable?(t.element.on("click.modal",function(){t.close()}),t.element.on("click.modal",".modal-container",function(b){a(b.target).hasClass("close")||b.stopPropagation()}),a(document).bind("keyup.modal",function(a){"27"==a.keyCode&&t.close()})):t.element.find("button.close").hide(),setTimeout(function(){t.options.afterOpen.call(t.element,t)},600),t)},this.close=function(){return t.options.beforeClose.call(t.element,t)===!1?!1:(b.pop(),t.element.find(".modal-container").css({"transition-duration":".5s, .3s","-webkit-transition-duration":".5s, .3s"}),t.element.off("click.modal"),a(document).unbind("keyup.modal"),t.element.removeClass("show"),setTimeout(function(){0===b.length&&m(),t.element.removeClass("animate"),i(),Modernizr.rgba||t.element.find(".ie8-overlay").remove(),t.element.find(".modal-container").css({"transition-duration":"","-webkit-transition-duration":""}),t.options.afterClose.call(t.element,t),t.element.data("destroyOnClose")&&t.element.remove()},500),t)},this.update=function(a,b){return t.content=a,t.element.find(".modal-content").html(a),"function"==typeof b&&b.call(t,t.element),i(),t},s()};window.Modal=c}(jQuery);